import{_ as T}from"./ngKatZUQ.js";import{e as C,r as v,c as w,a as l,l as _,F as U,j as D,v as h,q as S,h as q,o as g,d as k,t as A,f as B,s as F,b as V,w as I,g as K,p as L,x as M,y as R}from"#entry";import{u as j,C as z}from"./4Erf9eH_.js";const G={class:"space-y-2"},O={class:"flex gap-2 flex-wrap"},H=["onClick"],J=["onKeydown"],P=C({__name:"TagInput",props:{modelValue:{}},emits:["update:modelValue"],setup(y,{emit:x}){const d=y,r=x,o=v(""),u=()=>{const a=o.value.trim();if(!a)return;const s=new Set(d.modelValue);s.add(a),r("update:modelValue",Array.from(s)),o.value=""};return(a,s)=>(g(),w("div",G,[l("div",O,[(g(!0),w(U,null,D(y.modelValue,(n,c)=>(g(),w("span",{key:n+c,class:"chip"},[k(A(n)+" ",1),l("button",{class:"text-neutral-500",onClick:f=>a.$emit("update:modelValue",y.modelValue.filter((b,m)=>m!==c))},"✕",8,H)]))),128))]),_(l("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>o.value=n),class:"input w-full",placeholder:"Escribe una etiqueta y presiona Enter",onKeydown:S(q(u,["prevent"]),["enter"])},null,40,J),[[h,o.value]])]))}}),Q={class:"flex items-center gap-2"},W={class:"ml-auto flex items-center gap-2"},X=["disabled"],Y={class:"card p-4"},ae=C({__name:"[id]",setup(y){const x=R(),d=M(),r=j(),{push:o}=L(),u=B(()=>{const t=x.params.id;return Array.isArray(t)?t[0]:t??"new"}),a=v(""),s=v(""),n=v([]),c=v(!1),f=v(!1);function b(){a.value="",s.value="",n.value=[]}let m=0;async function E(t){const e=++m;if(b(),r.loaded||await r.load(),e!==m)return;const p=await r.get(t);if(e===m){if(!p){await d.push("/");return}a.value=p.title||"",s.value=p.content||"",n.value=p.tags||[]}}F(u,t=>{m++,t==="new"?b():E(t)},{immediate:!0});const N=async()=>{if(!f.value){f.value=!0;try{if(u.value==="new"){const t=await r.add(a.value,s.value),e=typeof t=="string"?t:t.id;n.value.length&&await r.update(e,{tags:n.value}),o("Nota creada","success"),await d.push("/")}else await r.update(u.value,{title:a.value,content:s.value,tags:n.value}),o("Cambios guardados","success"),await d.push("/")}catch(t){console.error(t),o("No se pudo guardar la nota","error")}finally{f.value=!1}}},$=async()=>{try{if(u.value==="new")return;await r.remove(u.value),o("Nota eliminada","error"),await d.push("/")}catch(t){console.error(t),o("No se pudo eliminar la nota","error")}};return(t,e)=>{const p=T;return g(),w("div",{key:u.value,class:"space-y-4"},[l("div",Q,[V(p,{to:"/",class:"btn btn-ghost"},{default:I(()=>[...e[5]||(e[5]=[k("← Volver",-1)])]),_:1}),l("div",W,[l("button",{onClick:N,class:"btn btn-primary",disabled:f.value},"Guardar",8,X),u.value!=="new"?(g(),w("button",{key:0,onClick:e[0]||(e[0]=i=>c.value=!0),class:"btn btn-danger"},"Eliminar")):K("",!0)])]),_(l("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>a.value=i),type:"text",placeholder:"Título",class:"input w-full text-2xl font-semibold"},null,512),[[h,a.value]]),_(l("textarea",{"onUpdate:modelValue":e[2]||(e[2]=i=>s.value=i),rows:"14",placeholder:"Escribe tu nota...",class:"input w-full min-h-[300px]"},null,512),[[h,s.value]]),l("div",Y,[e[6]||(e[6]=l("h3",{class:"font-semibold mb-2"},"Etiquetas",-1)),V(P,{modelValue:n.value,"onUpdate:modelValue":e[3]||(e[3]=i=>n.value=i)},null,8,["modelValue"])]),V(z,{open:c.value,"onUpdate:open":e[4]||(e[4]=i=>c.value=i),title:"Eliminar nota",message:`Esta acción no se puede deshacer. ¿Eliminar la nota «${a.value||"Sin título"}»?`,"confirm-text":"Eliminar","cancel-text":"Cancelar",variant:"danger",onConfirm:$},null,8,["open","message"])])}}});export{ae as default};
