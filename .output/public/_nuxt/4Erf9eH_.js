import{S as W,e as F,f as K,k as R,E as z,m as U,b as S,U as P,w as v,V as $,o as h,c as M,g as k,h as J,a as l,t as w,i as G,_ as H}from"#entry";const D=(e,t)=>t.some(n=>e instanceof n);let L,N;function Q(){return L||(L=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function X(){return N||(N=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const I=new WeakMap,b=new WeakMap,g=new WeakMap;function Y(e){const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("success",s),e.removeEventListener("error",a)},s=()=>{n(m(e.result)),o()},a=()=>{r(e.error),o()};e.addEventListener("success",s),e.addEventListener("error",a)});return g.set(t,e),t}function Z(e){if(I.has(e))return;const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",a),e.removeEventListener("abort",a)},s=()=>{n(),o()},a=()=>{r(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",s),e.addEventListener("error",a),e.addEventListener("abort",a)});I.set(e,t)}let x={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return I.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return m(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function j(e){x=e(x)}function q(e){return X().includes(e)?function(...t){return e.apply(A(this),t),m(this.request)}:function(...t){return m(e.apply(A(this),t))}}function ee(e){return typeof e=="function"?q(e):(e instanceof IDBTransaction&&Z(e),D(e,Q())?new Proxy(e,x):e)}function m(e){if(e instanceof IDBRequest)return Y(e);if(b.has(e))return b.get(e);const t=ee(e);return t!==e&&(b.set(e,t),g.set(t,e)),t}const A=e=>g.get(e);function te(e,t,{blocked:n,upgrade:r,blocking:o,terminated:s}={}){const a=indexedDB.open(e,t),d=m(a);return r&&a.addEventListener("upgradeneeded",i=>{r(m(a.result),i.oldVersion,i.newVersion,m(a.transaction),i)}),n&&a.addEventListener("blocked",i=>n(i.oldVersion,i.newVersion,i)),d.then(i=>{s&&i.addEventListener("close",()=>s()),o&&i.addEventListener("versionchange",c=>o(c.oldVersion,c.newVersion,c))}).catch(()=>{}),d}const ne=["get","getKey","getAll","getAllKeys","count"],re=["put","add","delete","clear"],p=new Map;function T(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(p.get(t))return p.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=re.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(o||ne.includes(n)))return;const s=async function(a,...d){const i=this.transaction(a,o?"readwrite":"readonly");let c=i.store;return r&&(c=c.index(d.shift())),(await Promise.all([c[n](...d),o&&i.done]))[0]};return p.set(t,s),s}j(e=>({...e,get:(t,n,r)=>T(t,n)||e.get(t,n,r),has:(t,n)=>!!T(t,n)||e.has(t,n)}));const se=["continue","continuePrimaryKey","advance"],V={},B=new WeakMap,_=new WeakMap,oe={get(e,t){if(!se.includes(t))return e[t];let n=V[t];return n||(n=V[t]=function(...r){B.set(this,_.get(this)[t](...r))}),n}};async function*ae(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,oe);for(_.set(n,t),g.set(n,A(t));t;)yield n,t=await(B.get(n)||t.continue()),B.delete(n)}function O(e,t){return t===Symbol.asyncIterator&&D(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&D(e,[IDBIndex,IDBObjectStore])}j(e=>({...e,get(t,n,r){return O(t,n)?ae:e.get(t,n,r)},has(t,n){return O(t,n)||e.has(t,n)}}));const ie="notas-rapidas-db",u="notes";function C(e){try{return JSON.parse(JSON.stringify(e))}catch{return e}}function y(e){return{id:String(e.id),title:String(e.title??""),content:String(e.content??""),createdAt:Number(e.createdAt??Date.now()),updatedAt:Number(e.updatedAt??e.createdAt??Date.now()),pinned:!!(e.pinned??!1),tags:Array.isArray(e.tags)?C(e.tags.map(t=>String(t))):[]}}class ce{constructor(){this.dbPromise=null}ensureDb(){if(!this.dbPromise){if(typeof indexedDB>"u")throw new Error("IndexedDB no disponible en este entorno");this.dbPromise=te(ie,1,{upgrade(t){t.createObjectStore(u,{keyPath:"id"}).createIndex("updatedAt","updatedAt")}})}return this.dbPromise}async getAll(){return(await(await this.ensureDb()).getAll(u)).map(r=>y(r))}async getById(t){const r=await(await this.ensureDb()).get(u,t);return r?y(r):null}async create(t){const n=await this.ensureDb(),r=y(C(t));return await n.put(u,r),r}async update(t,n){const r=await this.ensureDb(),o=await r.get(u,t);if(!o){const a=y({id:t,title:n.title??"",content:n.content??"",createdAt:Date.now(),updatedAt:Date.now(),pinned:n.pinned??!1,tags:Array.isArray(n.tags)?n.tags:[]});return await r.put(u,a),a}const s=y({...o,...C(n),id:t,updatedAt:Date.now()});return await r.put(u,s),s}async remove(t){await(await this.ensureDb()).delete(u,t)}}const f=new ce,ye=W("notes",{state:()=>({notes:[],loaded:!1}),actions:{async load(){if(this.loaded)return;const e=await f.getAll();this.notes=e.map(t=>({id:t.id,title:t.title??"",content:t.content??"",createdAt:t.createdAt??Date.now(),updatedAt:t.updatedAt??t.createdAt??Date.now(),pinned:t.pinned??!1,tags:Array.isArray(t.tags)?t.tags:[]})),this.loaded=!0},async add(e,t){const n={id:crypto.randomUUID(),title:e,content:t,createdAt:Date.now(),updatedAt:Date.now(),pinned:!1,tags:[]};return await f.create(n),this.notes.unshift(n),n},async update(e,t){if(this.loaded||await this.load(),!(this.notes.find(s=>s.id===e)||await f.getById(e))){const s={id:e,title:(t.title??"").toString(),content:(t.content??"").toString(),createdAt:Date.now(),updatedAt:Date.now(),pinned:t.pinned??!1,tags:Array.isArray(t.tags)?t.tags:[]};return await f.create(s),this.notes.unshift(s),s}const r=await f.update(e,{...t,updatedAt:Date.now()}),o=this.notes.findIndex(s=>s.id===e);return o!==-1?this.notes[o]=r:this.notes.unshift(r),r},async togglePin(e){const t=this.notes.find(n=>n.id===e);t&&await this.update(e,{pinned:!t.pinned})},async remove(e){await f.remove(e),this.notes=this.notes.filter(t=>t.id!==e)},async get(e){const t=this.notes.find(r=>r.id===e);return t||(await f.getById(e)??null)}}}),de={class:"w-full max-w-md rounded-2xl bg-white shadow-xl ring-1 ring-neutral-200"},ue={class:"px-5 pt-5"},le={class:"mt-5 flex items-center justify-end gap-2 px-5 pb-5"},fe=F({__name:"ConfirmDialog",props:{open:{type:Boolean},title:{default:"Confirmar acción"},message:{default:"¿Estás seguro?"},confirmText:{default:"Confirmar"},cancelText:{default:"Cancelar"},variant:{default:"danger"}},emits:["update:open","confirm","cancel"],setup(e,{emit:t}){const n=e,r=t,o=`dialog-title-${Math.random().toString(36).slice(2)}`,s=`dialog-desc-${Math.random().toString(36).slice(2)}`,a=K(()=>n.variant==="danger"?"bg-red-600":"bg-brand-500"),d=()=>{r("update:open",!1),r("cancel")},i=()=>{r("update:open",!1),r("confirm")};return R(()=>{const c=E=>{E.key==="Escape"&&n.open&&d()};window.addEventListener("keydown",c),z(()=>window.removeEventListener("keydown",c))}),(c,E)=>(h(),U($,{to:"body"},[S(P,{name:"fade"},{default:v(()=>[e.open?(h(),M("div",{key:0,class:"fixed inset-0 z-40 bg-black/40 backdrop-blur-sm",onClick:J(d,["self"])})):k("",!0)]),_:1}),S(P,{name:"pop"},{default:v(()=>[e.open?(h(),M("div",{key:0,class:"fixed inset-0 z-50 grid place-items-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":o,"aria-describedby":s},[l("div",de,[l("div",ue,[l("h3",{id:o,class:"text-lg font-semibold text-neutral-900"},w(e.title),1),l("p",{id:s,class:"mt-1 text-neutral-600"},w(e.message),1)]),l("div",le,[l("button",{type:"button",class:"rounded-xl border border-neutral-300 px-4 py-2 text-neutral-700 hover:bg-neutral-50",onClick:d},w(e.cancelText),1),l("button",{type:"button",class:G(["rounded-xl px-4 py-2 text-white hover:opacity-90",a.value]),onClick:i},w(e.confirmText),3)])])])):k("",!0)]),_:1})]))}}),we=H(fe,[["__scopeId","data-v-c0d6bf13"]]);export{we as C,ye as u};
